{% extends "layout.html" %}

{% block content %}
<section class="section-padding admin-section-bg">
    <div class="container">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-5" data-aos="fade-down">
            <div>
                <a href="{{ url_for('admin.admin_dashboard') }}" class="btn btn-outline-light btn-sm mb-3">
                    <i class="fas fa-arrow-right me-2"></i> العودة للوحة التحكم
                </a>
                <h2 class="section-title mb-0">إدارة المستخدمين (العملاء)</h2>
                <p class="text-muted mt-2">عرض وإدارة حسابات العملاء والمشاريع</p>
            </div>
            <div>
                <button class="btn btn-gold" data-bs-toggle="modal" data-bs-target="#addUserModal">
                    <i class="fas fa-plus me-2"></i> إضافة عميل جديد
                </button>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="row mb-5 g-4" data-aos="fade-up">
            <div class="col-lg-3 col-md-6">
                <div class="stat-card glass h-100">
                    <div class="stat-icon bg-blue-gradient">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3>{{ analytics.total_users }}</h3>
                        <p>إجمالي المستخدمين</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="stat-card glass h-100">
                    <div class="stat-icon bg-warning-gradient">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div class="stat-info">
                        <h3>{{ analytics.total_requests }}</h3>
                        <p>طلبات المعاينة</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="stat-card glass h-100">
                    <div class="stat-icon bg-success-gradient">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="stat-info">
                        <h3>{{ analytics.conversion_rate }}%</h3>
                        <p>نسبة التحويل</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="stat-card glass h-100">
                    <div class="stat-icon bg-danger-gradient">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <h3>{{ analytics.pending_questions }}</h3>
                        <p>أسئلة بانتظار الرد</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="divider mb-5"></div>

        <!-- Users Table -->
        <div class="mb-5" data-aos="fade-up">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="text-gold"><i class="fas fa-user-tie me-2"></i> قائمة العملاء</h3>
                <div class="search-box">
                    <input type="text" id="searchInput" class="form-control" placeholder="بحث عن عميل...">
                </div>
            </div>

            {% if users %}
            <div class="table-responsive">
                <table class="table modern-table" id="usersTable">
                    <thead>
                        <tr>
                            <th>الصورة</th>
                            <th>الاسم الكامل</th>
                            <th>اسم المستخدم</th>
                            <th>الهاتف</th>
                            <th>البريد</th>
                            <th>موقع المشروع</th>
                            <th>نسبة الإنجاز</th>
                            <th>تاريخ التسجيل</th>
                            <th>إجراءات</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users %}
                        <tr>
                            <td>
                                <div class="user-avatar">
                                    {% if user.profile_image %}
                                    <img src="{{ url_for('static', filename=user.profile_image) }}"
                                        alt="{{ user.full_name }}">
                                    {% else %}
                                    <div class="avatar-placeholder">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    {% endif %}
                                </div>
                            </td>
                            <td class="fw-bold text-white">{{ user.full_name }}</td>
                            <td>{{ user.username }}</td>
                            <td dir="ltr">{{ user.phone }}</td>
                            <td>{{ user.email or 'غير محدد' }}</td>
                            <td>{{ user.project_location }}</td>
                            <td>
                                <div class="progress-wrapper">
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-gold-gradient"
                                            style="width: {{ user.project_percentage }}%"></div>
                                    </div>
                                    <span class="progress-text">{{ user.project_percentage }}%</span>
                                </div>
                            </td>
                            <td class="small">{{ user.created_at[:10] }}</td>
                            <td>
                                <div class="btn-group" role="group">
                                    <a href="{{ url_for('user.profile', username=user.username) }}"
                                        class="btn btn-sm btn-outline-info" title="عرض الملف">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <button class="btn btn-sm btn-outline-warning" data-bs-toggle="modal"
                                        data-bs-target="#updatePercentageModal" data-username="{{ user.username }}"
                                        data-percentage="{{ user.project_percentage }}" title="تحديث النسبة">
                                        <i class="fas fa-percentage"></i>
                                    </button>
                                    <form method="POST" action="{{ url_for('user.delete', username=user.username) }}"
                                        style="display: inline;"
                                        onsubmit="return confirm('هل أنت متأكد من حذف هذا المستخدم؟');">
                                        <button type="submit" class="btn btn-sm btn-outline-danger" title="حذف">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <i class="fas fa-users fa-3x mb-3 opacity-25"></i>
                <p>لا يوجد عملاء مسجلين</p>
            </div>
            {% endif %}\r
        </div>

        <div class="divider mb-5"></div>

        <!-- Contact Requests Section -->
        <div class="mb-5" data-aos="fade-up">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="text-gold"><i class="fas fa-clipboard-list me-2"></i> طلبات المعاينة الأخيرة</h3>
                <span class="badge bg-warning">{{ messages|length }} طلب</span>
            </div>

            {% if messages %}
            <div class="table-responsive">
                <table class="table modern-table">
                    <thead>
                        <tr>
                            <th>الاسم</th>
                            <th>الهاتف</th>
                            <th>الخدمة</th>
                            <th>الرسالة</th>
                            <th>التاريخ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for msg in messages %}
                        <tr>
                            <td class="fw-bold text-white">{{ msg.name }}</td>
                            <td dir="ltr">{{ msg.phone }}</td>
                            <td><span class="badge bg-info">{{ msg.service or 'عام' }}</span></td>
                            <td class="text-truncate" style="max-width: 300px;">{{ msg.message }}</td>
                            <td class="small">{{ msg.created_at[:10] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <i class="fas fa-inbox fa-3x mb-3 opacity-25"></i>
                <p>لا توجد طلبات معاينة</p>
            </div>
            {% endif %}
        </div>

        <div class="divider mb-5"></div>

        <!-- Unanswered Questions Section -->
        {% if unanswered %}
        <div class="mb-5" data-aos="fade-up">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="text-gold"><i class="fas fa-question-circle me-2"></i> أسئلة بانتظار الرد</h3>
                <span class="badge bg-danger">{{ unanswered|length }} سؤال</span>
            </div>

            {% for q in unanswered %}
            <div class="question-card glass mb-3">
                <div class="question-header">
                    <strong class="text-gold">{{ q.user_id }}</strong>
                    <span class="small text-muted">{{ q.timestamp }}</span>
                </div>
                <div class="question-body">
                    <p class="mb-2"><strong>السؤال:</strong> {{ q.question }}</p>
                    <form method="POST" action="{{ url_for('admin.answer_question') }}">
                        <input type="hidden" name="question" value="{{ q.question }}">
                        <div class="mb-2">
                            <textarea name="answer" class="form-control" rows="2" placeholder="اكتب الإجابة هنا..."
                                required></textarea>
                        </div>
                        <button type="submit" class="btn btn-sm btn-gold">
                            <i class="fas fa-check me-1"></i> حفظ الإجابة
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="divider mb-5"></div>

        <!-- Advanced Analytics Section -->
        <div class="mb-5" data-aos="fade-up">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="text-gold"><i class="fas fa-chart-bar me-2"></i> الإحصائيات المتقدمة</h3>
            </div>

            <div class="row g-4 mb-4">
                <!-- Project Status -->
                <div class="col-lg-4 col-md-6">
                    <div class="analytics-card glass">
                        <h6 class="text-white mb-3">
                            <i class="fas fa-tasks text-gold me-2"></i>
                            حالة المشاريع
                        </h6>
                        <div class="analytics-item">
                            <span class="analytics-label">
                                <i class="fas fa-check-circle text-success me-1"></i>
                                مكتملة
                            </span>
                            <span class="analytics-value text-success">{{ analytics.completed_projects }}</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">
                                <i class="fas fa-spinner text-warning me-1"></i>
                                جارية
                            </span>
                            <span class="analytics-value text-warning">{{ analytics.ongoing_projects }}</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">
                                <i class="fas fa-pause-circle text-secondary me-1"></i>
                                لم تبدأ
                            </span>
                            <span class="analytics-value text-secondary">{{ analytics.not_started }}</span>
                        </div>
                    </div>
                </div>

                <!-- User Activity -->
                <div class="col-lg-4 col-md-6">
                    <div class="analytics-card glass">
                        <h6 class="text-white mb-3">
                            <i class="fas fa-users text-gold me-2"></i>
                            نشاط المستخدمين
                        </h6>
                        <div class="analytics-item">
                            <span class="analytics-label">
                                <i class="fas fa-user-check text-info me-1"></i>
                                مستخدمين نشطين
                            </span>
                            <span class="analytics-value text-info">{{ analytics.active_users }}</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">
                                <i class="fas fa-chart-line text-gold me-1"></i>
                                متوسط الإنجاز
                            </span>
                            <span class="analytics-value text-gold">{{ analytics.avg_completion }}%</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">
                                <i class="fas fa-comments text-primary me-1"></i>
                                طلبات معاينة
                            </span>
                            <span class="analytics-value text-primary">{{ analytics.total_requests }}</span>
                        </div>
                    </div>
                </div>

                <!-- Payments -->
                <div class="col-lg-4 col-md-6">
                    <div class="analytics-card glass">
                        <h6 class="text-white mb-3">
                            <i class="fas fa-money-bill-wave text-gold me-2"></i>
                            عمليات الدفع
                        </h6>
                        <div class="analytics-item">
                            <span class="analytics-label">
                                <i class="fas fa-credit-card text-success me-1"></i>
                                إجمالي العمليات
                            </span>
                            <span class="analytics-value text-success">{{ analytics.total_payments }}</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">
                                <i class="fas fa-percentage text-gold me-1"></i>
                                نسبة التحويل
                            </span>
                            <span class="analytics-value text-gold">{{ analytics.conversion_rate }}%</span>
                        </div>
                        <div class="analytics-item">
                            <span class="analytics-label">
                                <i class="fas fa-question-circle text-danger me-1"></i>
                                أسئلة معلقة
                            </span>
                            <span class="analytics-value text-danger">{{ analytics.pending_questions }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payment Records -->
        <div class="divider mb-5"></div>

        <div class="mb-5" data-aos="fade-up">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="text-gold"><i class="fas fa-money-bill-wave me-2"></i> عمليات الدفع الأخيرة</h3>
                {% if payments %}
                <span class="badge bg-success">{{ payments|length }} عملية</span>
                {% else %}
                <span class="badge bg-secondary">لا توجد عمليات</span>
                {% endif %}
            </div>

            {% if payments %}
            <div class="table-responsive">
                <table class="table modern-table">
                    <thead>
                        <tr>
                            <th>المستخدم</th>
                            <th>المبلغ</th>
                            <th>الوسيلة</th>
                            <th>التاريخ</th>
                            <th>الحالة</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in payments %}
                        <tr>
                            <td class="fw-bold text-white">{{ p.username }}</td>
                            <td class="text-gold fw-bold">{{ p.amount }} ج.م</td>
                            <td><span class="badge bg-primary">{{ p.method }}</span></td>
                            <td class="small">{{ p.timestamp[:10] }}</td>
                            <td><span class="badge bg-success">{{ p.status or 'قيد المراجعة' }}</span></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <i class="fas fa-wallet fa-3x mb-3 opacity-25"></i>
                <p>لا توجد عمليات دفع من المستخدمين</p>
            </div>
            {% endif %}
        </div>

    </div>
</section>

<!-- Add User Modal -->
<div class="modal fade" id="addUserModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content glass-modal">
            <div class="modal-header">
                <h5 class="modal-title text-gold">إضافة عميل جديد</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('admin.add_user') }}" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">اسم المستخدم</label>
                            <input type="text" name="username" class="form-control" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">الاسم الكامل</label>
                            <input type="text" name="full_name" class="form-control" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">رقم الهاتف</label>
                            <input type="tel" name="phone" class="form-control" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">البريد الإلكتروني</label>
                            <input type="email" name="email" class="form-control">
                        </div>
                        <div class="col-12">
                            <label class="form-label">موقع المشروع</label>
                            <input type="text" name="project_location" class="form-control" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label">وصف المشروع</label>
                            <textarea name="project_description" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="col-12">
                            <label class="form-label">صورة الملف الشخصي (اختياري)</label>
                            <input type="file" name="profile_image" class="form-control" accept="image/*">
                        </div>
                        <input type="hidden" name="role" value="user">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="submit" class="btn btn-gold">إضافة العميل</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Update Percentage Modal -->
<div class="modal fade" id="updatePercentageModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content glass-modal">
            <div class="modal-header">
                <h5 class="modal-title text-gold">تحديث نسبة الإنجاز</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('user.update_percentage') }}">
                <div class="modal-body">
                    <input type="hidden" name="username" id="updateUsername">
                    <label class="form-label">نسبة الإنجاز الجديدة</label>
                    <div class="input-group">
                        <input type="number" name="percentage" id="updatePercentage" class="form-control" min="0"
                            max="100" required>
                        <span class="input-group-text">%</span>
                    </div>
                    <div class="mt-3">
                        <input type="range" class="form-range" min="0" max="100" id="percentageSlider">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="submit" class="btn btn-gold">تحديث</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .admin-section-bg {
        background: #0a0a0a;
        min-height: 100vh;
        padding-top: 100px;
        direction: rtl;
    }

    /* Stat Cards */
    .stat-card {
        padding: 25px;
        border-radius: 20px;
        display: flex;
        align-items: center;
        gap: 20px;
        transition: 0.3s;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .stat-card:hover {
        transform: translateY(-5px);
        border-color: rgba(212, 175, 55, 0.3);
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: #fff;
    }

    .bg-blue-gradient {
        background: linear-gradient(135deg, #2196f3, #1976d2);
    }

    .bg-success-gradient {
        background: linear-gradient(135deg, #4caf50, #388e3c);
    }

    .bg-warning-gradient {
        background: linear-gradient(135deg, #ffc107, #ff9800);
    }

    .bg-purple-gradient {
        background: linear-gradient(135deg, #9c27b0, #7b1fa2);
    }

    .stat-info h3 {
        margin: 0;
        color: #fff;
        font-size: 1.8rem;
        font-weight: 800;
    }

    .stat-info p {
        margin: 0;
        color: #888;
        font-size: 0.9rem;
    }

    /* Search Box */
    .search-box input {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #fff;
        padding: 10px 15px;
        border-radius: 10px;
    }

    .search-box input:focus {
        background: rgba(255, 255, 255, 0.08);
        border-color: var(--gold);
        color: #fff;
        box-shadow: 0 0 0 0.2rem rgba(212, 175, 55, 0.25);
    }

    /* User Avatar */
    .user-avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        overflow: hidden;
        border: 2px solid var(--gold);
    }

    .user-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .avatar-placeholder {
        width: 100%;
        height: 100%;
        background: rgba(212, 175, 55, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--gold);
    }

    /* Analytics Cards */
    .analytics-card {
        padding: 25px;
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        background: rgba(255, 255, 255, 0.02);
        height: 100%;
    }

    .analytics-card h6 {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(212, 175, 55, 0.2);
    }

    .analytics-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .analytics-item:last-child {
        border-bottom: none;
    }

    .analytics-label {
        color: #ddd;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .analytics-value {
        font-size: 1.3rem;
        font-weight: 700;
    }

    /* Progress Wrapper */
    .progress-wrapper {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .progress {
        flex: 1;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
    }

    .bg-gold-gradient {
        background: linear-gradient(90deg, #FFD700, #D4AF37);
    }

    .progress-text {
        color: var(--gold);
        font-weight: 600;
        font-size: 0.85rem;
        min-width: 40px;
    }

    /* Tables */
    .modern-table {
        background: rgba(255, 255, 255, 0.02);
        border-radius: 15px;
        overflow: hidden;
    }

    .modern-table thead {
        background: rgba(212, 175, 55, 0.1);
    }

    .modern-table th {
        color: var(--gold);
        font-weight: 600;
        padding: 15px;
        border: none;
        font-size: 0.9rem;
    }

    .modern-table td {
        color: #ddd;
        padding: 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        vertical-align: middle;
    }

    .modern-table tbody tr:hover {
        background: rgba(255, 255, 255, 0.03);
    }

    /* Modals */
    .glass-modal {
        background: rgba(20, 20, 20, 0.95);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #fff;
    }

    .glass-modal .modal-header {
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .glass-modal .modal-footer {
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .glass-modal .form-control,
    .glass-modal .form-select {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #fff;
    }

    .glass-modal .form-control:focus,
    .glass-modal .form-select:focus {
        background: rgba(255, 255, 255, 0.08);
        border-color: var(--gold);
        color: #fff;
        box-shadow: 0 0 0 0.2rem rgba(212, 175, 55, 0.25);
    }

    .glass-modal .form-label {
        color: #ddd;
        font-weight: 500;
    }

    /* Question Cards */
    .question-card {
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        padding: 20px;
        background: rgba(255, 255, 255, 0.02);
    }

    .question-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .question-body {
        color: #ddd;
    }

    .question-body p {
        color: #fff;
    }

    .question-body .form-control {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #fff;
    }

    .question-body .form-control:focus {
        background: rgba(255, 255, 255, 0.08);
        border-color: var(--gold);
        color: #fff;
    }

    /* Buttons */
    .btn-gold {
        background: var(--gold);
        color: #000;
        font-weight: 700;
        border: none;
    }

    .btn-gold:hover {
        background: #FFD700;
        color: #000;
    }

    /* Glass Effect */
    .glass {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }

    .divider {
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.3), transparent);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #666;
    }

    /* Modal Enhancements */
    .border-bottom-gold {
        border-bottom: 2px solid rgba(212, 175, 55, 0.3) !important;
    }

    .border-top-gold {
        border-top: 2px solid rgba(212, 175, 55, 0.3) !important;
    }

    .divider-small {
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.2), transparent);
    }

    .modal-dialog-centered {
        display: flex;
        align-items: center;
        min-height: calc(100% - 1rem);
    }

    .glass-modal .form-label {
        color: #ddd;
        font-weight: 500;
        font-size: 0.9rem;
    }

    .glass-modal .form-label i {
        color: var(--gold);
        opacity: 0.8;
    }

    .glass-modal h6 {
        font-size: 1rem;
        font-weight: 600;
        padding-bottom: 10px;
    }

    .file-upload-wrapper {
        position: relative;
    }

    .file-upload-wrapper .form-control {
        cursor: pointer;
    }

    .file-upload-wrapper .form-control:hover {
        border-color: var(--gold);
    }

    .glass-modal input::placeholder,
    .glass-modal textarea::placeholder {
        color: rgba(255, 255, 255, 0.3);
        font-size: 0.85rem;
    }

    /* Enhanced Button Styling */
    .btn-gold {
        background: linear-gradient(135deg, #FFD700, #D4AF37) !important;
        color: #000 !important;
        font-weight: 700;
        border: none;
        padding: 10px 25px;
        font-size: 1rem;
        box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
        transition: all 0.3s ease;
    }

    .btn-gold:hover {
        background: linear-gradient(135deg, #FFF200, #FFD700) !important;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(212, 175, 55, 0.6);
        color: #000 !important;
    }

    .btn-gold:active {
        transform: translateY(0);
    }

    .modal-footer .btn-secondary {
        background: rgba(108, 117, 125, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #fff;
        font-weight: 600;
        padding: 10px 25px;
        transition: all 0.3s ease;
    }

    .modal-footer .btn-secondary:hover {
        background: rgba(108, 117, 125, 1);
        border-color: rgba(255, 255, 255, 0.4);
        transform: translateY(-2px);
    }
</style>

<script>
    // Search functionality
    document.getElementById('searchInput')?.addEventListener('input', function (e) {
        const searchTerm = e.target.value.toLowerCase();
        const rows = document.querySelectorAll('#usersTable tbody tr');

        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
    });

    // Update percentage modal
    const updateModal = document.getElementById('updatePercentageModal');
    if (updateModal) {
        updateModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const username = button.getAttribute('data-username');
            const percentage = button.getAttribute('data-percentage');

            document.getElementById('updateUsername').value = username;
            document.getElementById('updatePercentage').value = percentage;
            document.getElementById('percentageSlider').value = percentage;
        });
    }

    // Sync slider with input
    const slider = document.getElementById('percentageSlider');
    const input = document.getElementById('updatePercentage');

    if (slider && input) {
        slider.addEventListener('input', function () {
            input.value = this.value;
        });

        input.addEventListener('input', function () {
            slider.value = this.value;
        });
    }
</script>
{% endblock %}